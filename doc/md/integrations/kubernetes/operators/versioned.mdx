---
title: Kubernetes Operator - Versioned Workflow
id: versioned
slug: /integrations/kubernetes/operators/versioned
---

import Credentials from './credentials.mdx';

### Installation

The Atlas Kubernetes Operator is available as a Helm Chart.
To install the chart with the release name `atlas-operator`:

```bash
helm install atlas-operator oci://ghcr.io/ariga/charts/atlas-operator
```

### Credentials
<Credentials/>

### Migrate with Local Directory

The Atlas Operator supports defining the migration directory as `ConfigMap` 
with key-value pairs where the key is the file name and the value is the content of the migration file.

```yaml title="atlas-migration-configmap.yaml"
apiVersion: v1
kind: ConfigMap
metadata:
  name: migration-dir
data:
  20230316085611.sql: |
    create table users (
      id int not null auto_increment,
      name varchar(255) not null,
      email varchar(255) unique not null,
      short_bio varchar(255) not null,
      primary key (id)
    );
  atlas.sum: |
    h1:W/ujmfqFLOAFDscMEVJ2wrbh4MrpVHENKEP9bVH3mlc=
    20230316085611.sql h1:Bb6K2XoJavRLhMIsITnxtWLiBhe/Dfp5X5yNxBYP++I=
```

Then, update the `AtlasMigration` resource to reference the config map key:

```yaml title="atlas-migration.yaml"
apiVersion: db.atlasgo.io/v1alpha1
kind: AtlasMigration
metadata:
  name: atlasmigration-sample
spec:
  urlFrom:
    secretKeyRef:
      key: url
      name: db-credentials
  dir:
    configMapRef:
      name: "migration-dir" # ConfigMap name of atlas-migration-configmap.yaml
```

### Migrate with Remote Directory

For those who have a migration directory in Atlas Cloud, 
you can configure the operator to use the directory for migration

`cloud` , `dir` are required to use the remote directory

```yaml title="atlas-migration-dir.yaml"
apiVersion: db.atlasgo.io/v1alpha1
kind: AtlasMigration
metadata:
  name: atlasmigration-sample
spec:
  urlFrom:
    secretKeyRef:
      key: url
      name: db-credentials
  cloud:
    project: "cloud" # Atlas Cloud project name
    tokenFrom:
      secretKeyRef:
        key: token
        name: atlas-credentials
  dir:
    remote: 
      name: "atlas" # Migration directory name in your atlas cloud project
      tag: "commit-id" # When tag is not specified, the latest tag will be used
```

## Configuration for the `AtlasMigration` resource

The AtlasMigration resource is used to define the desired state of a target database.

### `envName`

The `envName` sets the environment name used for reporting runs to Atlas Cloud.
By default, the environment name is set to `Kubernetes`.

```yaml
envName: "production"
```

### `url`

The `url` field is used to define the URL of the target database directly.
This is not recommended, but may be useful for testing purposes.

```yaml
url: "mysql://user:pass@localhost:3306/myapp"
```

#### `urlFrom`

The `urlFrom` field is used to load the URL of the target database from another resource such as a
Kubernetes secret.

```yaml
urlFrom:
    secretKeyRef:
      key: url
      name: db-credentials
```

### `cloud`

Cloud is used to define the Atlas Cloud configuration.

#### `project`

The `project` field is used to define the project name.

```yaml
cloud:
  project: "cloud"
```

#### `tokenFrom`

The `tokenFrom` field is used to load the Atlas Cloud token from another resource such as a Kubernetes secret.

```yaml
cloud:
  tokenFrom:
    secretKeyRef:
      key: token
      name: atlas-credentials
```

### `dir`

The `dir` field is used to define the migration directory.
For local directory, use `configMapRef` to reference the `ConfigMap` that contains the migration files.

```yaml
dir:
  configMapRef:
    name: "migration-dir" # ConfigMap name of atlas-migration-configmap.yaml
```

For remote directory, use `remote` to define the migration directory in Atlas Cloud.

```yaml
dir:
  remote: 
    name: "atlas"
    tag: "commit-id"
```

### `revisionsSchema`

The `revisionsSchema` field is used to define the schema name for the revisions table.
Details about the revisions table can be found in the [Revisions Schema](/versioned/apply#schema-revision-information).

```yaml
revisionsSchema: "atlas"
```